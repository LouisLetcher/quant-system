<!DOCTYPE html>
<html>
<head>
    <title>Backtest Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .summary { background-color: #e9f7ef; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .positive { color: green; }
        .negative { color: red; }
    </style>
</head>
<body>
    <h1>Backtest Report for {{ data.strategy }}</h1>
    
    <div class="summary">
        <h2>Summary</h2>
        <p><strong>Asset:</strong> {{ data.asset }}</p>
        <p><strong>Initial Capital:</strong> ${{ data.initial_capital|default(10000, true)|number_format(2) }}</p>
        <p><strong>Final Value:</strong> ${{ data.final_value|default(data.initial_capital, true)|number_format(2) }}</p>
        <p><strong>Profit & Loss:</strong> <span class="{{ 'positive' if data.pnl and data.pnl.startswith('$') and not data.pnl.startswith('$-') else 'negative' }}">{{ data.pnl }}</span></p>
        <p><strong>Sharpe Ratio:</strong> {{ data.sharpe_ratio }}</p>
        <p><strong>Max Drawdown:</strong> {{ data.max_drawdown }}</p>
        <p><strong>Commission Rate:</strong> {{ data.commission|default(0.001, true) * 100 }}%</p>
        <p><strong>Number of Trades:</strong> {{ data.trades|default(0, true) }}</p>
        
        {% if data.take_profit %}
        <p><strong>Take Profit:</strong> {{ data.take_profit * 100 }}%</p>
        {% endif %}
        
        {% if data.stop_loss %}
        <p><strong>Stop Loss:</strong> {{ data.stop_loss * 100 }}%</p>
        {% endif %}
    </div>

    {% if data.performance_chart %}
    <h2>Performance Chart</h2>
    <img src="{{ data.performance_chart }}" width="80%" />
    {% endif %}

    {% if data.trades_list and data.trades_list|length > 0 %}
    <h2>Trade Log</h2>
    <table>
        <tr>
            <th>Date</th>
            <th>Trade Type</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>P&L</th>
        </tr>
        {% for trade in data.trades_list %}
        <tr>
            <td>{{ trade.date }}</td>
            <td>{{ trade.type }}</td>
            <td>${{ trade.price|number_format(2) }}</td>
            <td>{{ trade.quantity }}</td>
            <td class="{{ 'positive' if trade.pnl >= 0 else 'negative' }}">
                ${{ trade.pnl|default(0, true)|number_format(2) }}
            </td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <p><em>No detailed trade data available. Total trades: {{ data.trades|default(0, true) }}</em></p>
    {% endif %}
</body>
</html>